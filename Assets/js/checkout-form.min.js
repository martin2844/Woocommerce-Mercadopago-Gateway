"use strict";function _instanceof(e,n){return null!=n&&"undefined"!=typeof Symbol&&n[Symbol.hasInstance]?!!n[Symbol.hasInstance](e):e instanceof n}function _classCallCheck(e,n){if(!_instanceof(e,n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,n){for(var t=0;t<n.length;t++){var a=n[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,n,t){return n&&_defineProperties(e.prototype,n),t&&_defineProperties(e,t),e}function _defineProperty(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}!function(e,n,t){var a;n.setPublishableKey(e.public_key),t(document.body).on("updated_checkout",function(){return new c(".wc-mp-gateway-form")}),t("form.checkout.woocommerce-checkout").on("checkout_place_order_wc_mp_gateway",function(){var e=document.querySelector(".wc-mp-gateway-form");if(r.createToken(e),!e.querySelector('input[name="CcToken"]'))return!1});var r={getBin:function(e){return e.substring(0,7)},createToken:function(e){n.clearSession(),n.createToken(e,function(n,t){if(200===n||201===n){var a=e.querySelector('input[name="CcToken"]');if(a)a.value=t.id;else{var r=document.createElement("input");r.setAttribute("name","CcToken"),r.setAttribute("type","hidden"),r.setAttribute("value",t.id),e.appendChild(r)}}})}},c=function(){function t(c){var i=this;_classCallCheck(this,t),_defineProperty(this,"showInstallmentLabel",function(){var e=i.elems.installments.selectedIndex,n=i.elems.installments.options[e].getAttribute("data-label");i.elems.installmentsRateLabel.innerHTML=n}),_defineProperty(this,"createCardToken",function(){i.ccTokenValues.number=i.elems.ccHiddenNumber.value,i.ccTokenValues.name=i.elems.ccName.value,i.ccTokenValues.month=i.elems.ccHiddenMonth.value,i.ccTokenValues.year=i.elems.ccHiddenYear.value,i.ccTokenValues.cvc=i.elems.ccCvc.value,i.ccTokenValues.document=i.elems.ccDocumentNumber.value,r.createToken(i.elems.form)}),_defineProperty(this,"checkCardToken",function(e){var n=i.elems.ccHiddenNumber.value;if(n.length<16)return!1;if(i.elems.ccName.value.length<3)return!1;var t=i.elems.ccHiddenMonth.value;if(!t)return!1;var a=i.elems.ccHiddenYear.value;if(!a)return!1;var r=i.elems.ccCvc.value;if(r.length<3)return!1;var c=i.elems.ccDocumentNumber.value;if(c.length<5)return!1;i.ccTokenValues.number===n&&i.ccTokenValues.month===t&&i.ccTokenValues.year===a&&i.ccTokenValues.cvc===r&&i.ccTokenValues.document===c||i.createCardToken()}),_defineProperty(this,"syncCcNumber",function(e){var n=e.currentTarget.value.replace(/\D/g,"");i.elems.ccHiddenNumber.value=n}),_defineProperty(this,"handleNewccNumber",function(t){var c=r.getBin(i.elems.ccNumber.value);c.length<7||a===c||(a=c,c=c.replace(/\D/g,""),n.getPaymentMethod({bin:c},i.setPaymentMethodInfo.bind(i)),n.getInstallments({bin:c,amount:e.cart_amount},i.setInstallmentsInfo.bind(i)))}),_defineProperty(this,"clearExpirationDate",function(){i.elems.ccHiddenMonth.value="",i.elems.ccHiddenYear.value=""}),_defineProperty(this,"setExpirationDates",function(e){var n=e.match(/[0-9]{2}/g);if(2!==n.length)return!1;i.setMonthExpirationDate(n[0]),i.setYearExpirationDate(n[1])}),_defineProperty(this,"setPaymentMethodInfo",function(e,t){200===e&&(i.elems.hiddenPaymentMethodId.value=t[0].id,n.getIdentificationTypes())}),_defineProperty(this,"setInstallmentsInfo",function(e,n){if(200===e){var t=null,a=null;for(var r in n){var c=n[r];if("gateway"===c.processing_mode){t=c;break}"aggregator"===c.processing_mode&&(a=c)}t?i.elems.hiddenInstallmentsType.value="gateway":a&&(i.elems.hiddenInstallmentsType.value="aggregator",t=a),i.setInstallments(t.payer_costs)}}),_defineProperty(this,"setInstallments",function(e){for(;i.elems.installments.options.length;)i.elems.installments.options.remove(0);e.forEach(function(e){var n=document.createElement("option"),t=e.labels.length,a=0;for(a=0;a<t;a++){if(-1!==e.labels[a].indexOf("CFT_"))break}n.text=e.recommended_message,n.setAttribute("data-label",e.labels[a]),n.setAttribute("value",e.installments),i.elems.installments.appendChild(n)})}),_defineProperty(this,"setMonthExpirationDate",function(e){i.elems.ccHiddenMonth.value=e}),_defineProperty(this,"setYearExpirationDate",function(e){i.elems.ccHiddenYear.value=e});var l=document.querySelector(c);this.elems={form:l,ccName:l.querySelector('input[name="ccName"]'),ccExpiry:l.querySelector('input[name="ccExpiry"]'),ccNumber:l.querySelector('input[name="ccNumber"]'),ccCvc:l.querySelector('input[name="ccCvc"]'),ccDocumentNumber:l.querySelector('input[name="docNumber"]'),hiddenPaymentMethodId:l.querySelector('input[name="hiddenPaymentMethodId"]'),installments:l.querySelector('select[name="installments"]'),installmentsRateLabel:l.querySelector(".installments_rate"),hiddenInstallmentsType:l.querySelector('input[name="hiddenInstallmentsType"]'),ccHiddenNumber:l.querySelector('input[name="hiddenCcNumber"]'),ccHiddenMonth:l.querySelector('input[name="hiddenExpiryMonth"]'),ccHiddenYear:l.querySelector('input[name="hiddenExpiryYear"]')},this.ccTokenValues={number:null,name:null,month:null,year:null,cvc:null,document:null},new Card({form:this.elems.form,container:".wc-mp-gateway-form-card",formSelectors:{numberInput:'input[name="ccNumber"]',expiryInput:'input[name="ccExpiry"]',cvcInput:'input[name="ccCvc"]',nameInput:'input[name="ccName"]'},width:e.card_size}),this.elems.ccNumber.addEventListener("keyup",this.handleNewccNumber.bind(this)),this.elems.ccExpiry.addEventListener("keyup",this.handleExpiryDateChange.bind(this)),this.elems.installments.addEventListener("change",this.showInstallmentLabel.bind(this)),this.elems.ccNumber.addEventListener("keyup",this.syncCcNumber.bind(this)),this.elems.form.addEventListener("keyup",this.checkCardToken.bind(this))}return _createClass(t,[{key:"handleExpiryDateChange",value:function(e){var n=e.currentTarget;n.classList.contains("jp-card-valid")?this.setExpirationDates(n.value):this.clearExpirationDate()}}]),t}()}(wc_mp_gateway_settings,Mercadopago,jQuery);